XCom经济模型

# xTokens
xTokens 是支持EIP20和EIP2612协议的带息token。每个货币市场都按照实现EIP20和EIP2612协议的智能合约进行结构化，xToken的价值与相应货币资产以1：1的比例锚定，可以安全的存储、转让或交易。用户的余额表示为xToken余额，xToken通过用户存入资产来铸造，由用户赎回资产而烧毁。

|xToken|小数位|源Token|源小数位|
|:---:|:---:|:---:|:---:|
|xETH|18|ETH|18|
|xUSDT|6|USDT|6|
|xFIL|8|FIL|8|


当放贷人放入 FIL 到智能合约时，智能合约会产生出的 xFIL 给放贷人。而放贷人随时能以 xFIL 换回原本的 FIL 以及多出来 FIL 的利息。  

例如小葵存入 1000 FIL，获得 1000 xFIL 作为小葵得存款凭证。整个市场的储备金标准收益指数将随着时间，按照市场的利率进行不断累加。因此小葵的存款收益也将随着时间不断累加：

假设当前的年利率率为20%，储备金标准收益指数为初始值1  
存款1个月之后的储备金标准收益指数为：之前的收益指数乘以1个月的利率，再加上之前的收益指数，即：1.0164  
小葵的FIL增加到 1016.4 以及还有挖矿得到的收益xc  

可以看到整个市场的储备金标准收益指数，从1开始随着时间持续增长，增长的速度受存款年利率影响，年利率越高，增长的速度就越快。  

# 储备金标准收益指数
储备金标准收益指数依照以下数据进行计算：
- T 时间戳
- $T_l$ 上一次更新时间戳
- <a href="https://www.codecogs.com/eqnedit.php?latex=T_{year}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?T_{year}" title="T_{year}" /></a> 一年的秒数，31536000
- $L_t$ 储备金总额
- $B_s$ 稳息借款总额
- $B_v$ 活息借款总额
- $R_{sa}$ 平均稳息借款利率
- $R_v$ 活息借款利率  

t时刻的储备金标准收益指数 $I_n^t$ 为：
$$I_n^0 = 1$$
$$I_n^t = {({\frac{B_s \times R_{sa} + B_v \times R_v}{L_t}} \times {\frac{T - T_l}{T_{year}}} + 1) \times I_n^{t-1}}$$
可以看出：借款的利润越高，存款的时间越长，收益指数增加的越快。

# 使用率
Xcom无需和供应商、借款人、条款、利率进行谈判，而是利用一种利率模型，该模型基于供求关系实现利率均衡。根据经济学理论，利率（货币的“价格”）应随需求而增加；当需求低时，利率应该低，反之亦然。每个市场 a 的使用率 U 将供需统一为一个变量：
$$U = {{B_s + B_v} \over L_t}$$
Xcom根据模型设置有一个目标利用率。当利用率低于目标利用率时，借款利率将随着利用率的提升缓慢增加，以刺激更多的借款行为。当利用率高于目标利用率时，借款利率将随着利用率的上升急剧拉升，以刺激更多的用户存入资产，提供充足的储备金。

# 活息借款利率
活息借款利率受下面的因素影响：
+ U 利用率以及目标利用率$U_{optimal}$
+ $R_{v0}$ 基础活息借款利率。
+ $R_{slope1}$ 利用率小于目标利用率时，利率增长常数。
+ $R_{slope2}$ 利用率大于等于目标利用率时，利率增长常数。

活息借款利率 $R_v$ 为：  
+ 利用率小于等于目标利用率时：
    $$R_v = {R_{v0} + {\frac{U}{U_{optimal}}  \times R_{slope1}}}$$
+ 利用率大于目标利用率时：
    $$R_v = {R_{v0} + R_{slope1} + {\frac{U - U_{optimal}}{1 - U_{optimal}} \times R_{slope2}}}$$

# 活息借款利率的更新周期
实际上，只要使用率一有变化，利率就会立即更新。XCom按照秒为单位来计算利息。

举个例子：  
小志于10 月10 日11:00 在 FIL 智能合约借了100,000 FIL，这个时候的借款年利率 = 10%。在10 月10 日12:00 时，由于使用率的更新，小志的借款年利率变成15%。小志于10 月10 日13:00 决定连本带利偿还所有债务，请问小志总共需要支付多少钱呢？  

>在11:00~12:00中：借款年利率 = 10%，小志活息借款累积指数为：
$$({\frac{0.1}{365 \times 24 \times 3600}} + 1)^{3600} = 1.0000114$$
因此小志需要支付的利息为1.14 FIL  
>在12:00~13:00中：借款年利率 = 15%，小志活息借款累积指数为:
$$1.0000114 \times ({\frac{0.15}{365 \times 24 \times 3600}} + 1)^{3600} = 1.0000285$$
因此小志总共需要支付的利息为2.85 FIL  
也就是说小志偿还时，共需要偿还 100,002.85 FIL

# 稳息借款利率
稳息借款是指：用户借款时，根据市场情况计算得到一个借款利率，除非整个市场出现巨大的波动，用户这一笔借款的利率会保持不变。 

稳息借款利率，除了受利用率以及利率增长常熟的影响，还引入了市场平均借款利率 $M_r$。市场平均贷款利率，所有平台贷款收益与所有平台贷款总量的比。通过借贷利率预言机获取其他平台的数据计算得到。
$$M_r = {\sum_{i=1}^n{P_r^i \times P_v^i} \over \sum_{i=1}^n{P_v^i}}$$

稳息借款利率 $R_s$ 的计算方式如下：  
+ 利用率小于等于目标利用率时：
$$R_S^t = M_r + {\frac{U}{U_{optimal}} \times R_{slope1}}$$
+ 利用率大于目标利用率时：
$$R_S^t = M_r + R_{slope1}+ {\frac{U - U_{optimal}}{1 - U_{optimal}} \times R_{slope2}}$$

平均稳息借款利率 $R_{sa}^t$ 的更新方式如下：  
 
+ 当利率为$R_s$时，存入金额$B_{new}$，$R_{sa}^t$更新为：之前的稳息借款收益，加上新存入的收益，与新的稳息借款总量的比
$$R_{sa}^t = {\frac{{B_s \times R_{sa}^{t-1}}+{B_{new} \times R_s}}{B_s + B_{new}}}$$

+ 当利率为$R_{sx}$时，偿还金额$B_x$，$R_{sa}^t$更新为：之前的稳息借款收益减去偿还金额的收益，与新的稳息借款总量的比
$$R_{sa}^t = {\frac{{B_s \times R_{sa}^{t-1}}-{B_x \times R_{sx}}}{B_s - B_x}}$$

# 资产清算
健康指数：用户所有抵押资产换算成USDT的价值，乘以一个保证金系数，比上用户贷款金额换算成USDT的价值与交易费的和，得到一个健康指数。指数越大就越安全，当指数小于1表面资不抵债，就可以进行资产清算了。

# 喂价
XCom支持通过 ChainLink 预言机来获取汇率，确定资产的价值。用于确定借贷能力和抵押要求，健康指数的计算，以及所有涉及资产价值的功能。
