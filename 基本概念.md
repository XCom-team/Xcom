# reserve
储备库。管理Token的存贷。每一个Token对应一个储备库。
# 时间戳
+ T  
当前时间戳
+ $T_l$  
最近更新时间戳
+ $\Delta T = T - T_l$
+ $T_{year} = 365 \times 24 \times 60 \times 60 = 31536000$
+ $\Delta T_{year} = {{\Delta T} \over T_{year}}$
# 资金名称
+ $L_t$  
total liquidity 储备库中可用流动资金总额。有效性与储备库的Token一致。
+ $B_s$  
total stable borrows 定息贷款利率贷款总数
+ $B_v$  
total variable borrows 变息贷款利率贷款总数
+ $B_t$  
total borrows 总借款数 $$B_t = B_s + B_v$$
# 利用率
+ U  
utilization rate 利用率:总借款数与总流动资金的比。流动金为0时，利用率也为0。
$$U = {B_t \over L_t}$$
+ $U_{optimal}$  
target utilization rate 目标利用率：经济模型追求的最佳利用率，避免变息贷款利率急速升高，也就是需要开始更有效的吸引存款，来降低使用率，以此来稳定利率。常数。
# 贷款利率
单位 $RAY = 1e27$
## 变息贷款利率
+ $R_{v0}$  
base variable borrow rate 基础变息贷款利率。$B_t = 0$时的利率。
+ $R_{slope1}$  
利用率小于目标利用率时，利率与利用率的比。常数。$R \over U$
+ $R_{slope2}$  
利用率大于等于目标利用率时，利率与利用率的比。常数。$R \over U$
+ $R_v$  
变息贷款利率
    - 利用率小于等于目标利用率时
    $$R_v = {R_{v0} + {\frac{U}{U_{optimal}}  \times R_{slope1}}}$$
    - 利用率大于目标利用率时
    $$R_v = {R_{v0} + R_{slope1} + {\frac{U - U_{optimal}}{1 - U_{optimal}} \times R_{slope2}}}$$
## 定息贷款利率
+ $R_s$  
stable rate 定息贷款利率，计算方式与变息一样，由$M_r$代替$R_{v0}$
$$R_S^t = M_r + {\frac{U}{U_{optimal}} \times R_{slope1}} , {U \leq U_{optimal}}$$
$$R_S^t = M_r + R_{slope1}+ {\frac{U - U_{optimal}}{1 - U_{optimal}} \times R_{slope2}} , {U > U_{optimal}}$$

备注：定息贷款利率只作用于新开的贷款。
定息贷款利率的目的，流动性越多，定息贷款越有效。
+ $M_r$  
average market lending rate 市场平均贷款利率。等于所有平台贷款收益与所有平台贷款总量的比。通过预言机获取其他平台的利率,用于参与确定定息利率。
$$M_r = {\sum_{i=1}^n{P_r^i \times P_v^i} \over \sum_{i=1}^n{P_v^i}}$$
+ $R_{sa}^t$  
average stable rate borrow rate 平均定息贷款利率
    - 当利率为$R_s$时，存入金额$B_{new}$，$R_{sa}^t$更新为：之前的定息贷款收益，加上新存入的收益，与新的定息贷款总量的比
    $$R_{sa}^t = {\frac{{B_s \times R_{sa}^{t-1}}+{B_{new} \times R_s}}{B_s + B_{new}}}$$
    - 当利率为$R_{sx}$时，偿还金额$B_x$，$R_{sa}^t$更新为：之前的定息贷款收益减去偿还金额的收益，与新的定息贷款总量的比
    $$R_{sa}^t = {\frac{{B_s \times R_{sa}^{t-1}}-{B_x \times R_{sx}}}{B_s - B_x}}$$
    $B_s = B_x$则$R_{sa}^t$为0。
## 总贷款利率
+ $R_o$  
overall borrow rate 总贷款利率，等于两种贷款的收益之和比上两种贷款的总金额。$$R_o = {\frac{B_v \times R_v + B_s \times R_{sa}}{B_t}}$$
+ $R_l$  
current liquidity rate 当前流动资金贷款利率，等于两种贷款的收益之和比上可用流动资金总和。
$$R_L = R_o \times U = {\frac{B_v \times R_v + B_s \times R_{sa}}{L_t}}$$
# 指数
+ $C_i^t$  
cumulated liquidity index 流动资金累积指数。储备库的每次存，借等操作，都会更新。根据之前的指数，按照利率和时间进行累积更新。  
解读：
按照时间段进行累加。  
初始为1ray。第一次为1ray加上时间段利率(*利率乘以时间段秒数，再除以年的秒数*)的增加值。后续计算都是上一期的指数，加上上期指数在时间段按利率的增长量。
$$C_i^t = {(R_l \times \Delta T_{year} + 1) \times C_i^{t-1}}$$
$$C_i^0 = 1 RAY$$
+ $I_n^t$  
reserve normalized income 储备库标准收益指数。持续累积的储备库指数。$I_n^t = C_i^t$  
+ $B_{vc}^t$  
cumulated variable borrow index 变息贷款累计指数。表示变息贷款$B_v$，利率$R_v$时的变息贷款的累积指数。储备库的每次存，借等操作，都会更新。  
解读：  
按秒进行累积，每过一秒指数增加一个秒利率。初始为1ray
$$B_{vc}^t = {(1 + {R_v \over T_{year}})^{\Delta T_x} \times B_{vc}^{t-1}}$$
$$B_{vc}^0 = 1 RAY$$
+ $B_{vcx}^t$  
user cumulated variable borrow index 用户变息贷款累积指数 $B_{vcx}^t = B_{vc}^t$
+ $B_x$  
user principal borrow balance 用户本金余额？每秒按复利方式进行计算累积叠加。
+ $B_{xc}$  
user compounded borrow balance 用户复合余额？本金余额，加上复利。
    - 变息贷款头寸 $B_{xc} = {B_{vc} \over B_{vcx}} \times (1 + {R_v \over T_{year}})^{\Delta {T_x}} \times B_x$  
    `B_{vx} == B_{vcx}` ????
    - 定息贷款头寸 $B_{xc} = (1 + {R_v \over T_{year}})^{\Delta {T_x}} \times B_x$
+ $H_f$  
health factor 健康因数，当小于1时，说明已经处于超抵押状态，可以进行清算。
$$H_f = {{TotalCollateralETH \times L_Q^a} \over {B_t + T otalF eesETH}}$$